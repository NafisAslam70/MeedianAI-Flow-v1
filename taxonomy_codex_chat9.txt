TAXONOMY CODEX ‚Äî CHAT 9
Updated: 2025-09-07 (MSP‚ÄëR + Daily Slots + MeedRepo + Community)

Scope for this session
- Create and maintain a running log for changes and plans.
- Track UI/UX upgrades, seeding flow, teacher-wise MSP-R, Routine Manager (AI), and upcoming Resource Management module.

Changes completed (rollup)
1) AdminSidebar
   - Added dynamic Programs list and renamed MRI item to ‚ÄúProgram Design‚Äù.
2) MSP Codes
   - Refactor to modern cards/tables, search, filters (Assigned/Unassigned), and quick actions.
3) Program pages
   - MSP‚ÄëR: class-wise grid + teacher-wise view with chips, Next/Shuffle.
   - Seed flow: ‚ÄúShow Default Seed‚Äù modal with default matrix preview + seed button.
   - Routine Manager (AI): modal to generate/edit JSON via DELU‚ÄëGPT/OpenAI model selector; Apply Seed posts customMatrix.
4) Direct Message templates (Profile)
   - Template picker + optional footer toggle (timestamp + portal link).
   - Backend supports includeFooter.
5) General Dashboard ‚Äî MSP‚ÄëR below N‚ÄëMRI
   - Added MSP‚ÄëR modal to the main dashboard under MRIs, just below N‚ÄëMRI.
   - Data: reads metaPrograms ‚Üí programPeriods/programScheduleCells (MSP) with member‚Äëread access.
   - Views: Class‚Äëwise and Teacher‚Äëwise; track toggle (Elementary / Pre‚ÄëPrimary).
   - Teacher‚Äëwise guard: if no assignments in selected track, show hint to check the other track.
   - Code Owners: modal lists owners per MSP code in current track (Primary flagged).
   - Mobile: stacked cards for both views; desktop keeps tables. Tooltips on codes.

6) Daily Slots (Admin > ManageMeedian > MRI & Roles > Daily Slots)
   - New tabs: Full Day (Blocks), N‚ÄëMRI, A‚ÄëMRI, O‚ÄëNMRI.
   - Full Day (Blocks): editable grid by blocks (incl. Block 6); modal to edit a slot‚Äôs TOD.
   - Bulk Allotments: landscape modal to assign TODs for all N‚ÄëMRI slots; block filter + search; mobile-friendly.
   - Slots Meta: CRUD with landscape table (Block/Type/Name/Start/End), add/delete slot, batch save.
   - API: PATCH slots supports name/start/end and assignment; POST/DELETE for create/remove.
   - MEED day template wired (Slots 0‚Äì17; AMRI/NMRI) for context and defaults.

7) General Dashboard polish
   - Mobile scroll restored + safe-area padding; desktop retains centered panel.
   - Added ‚ÄúAll MRNs‚Äù, ‚ÄúMeed Repo‚Äù quick buttons; MRIs card gains ‚ÄúNMRI Plan (D/L by Day)‚Äù.
   - NMRI Plan modal: renders day-wise Discipline/Language per slot using day/role assignments.
   - Lightweight mobile chat dock (AI + chat) on phones only.

8) Meed Repo (Verification Posts)
   - Padlet-style quick post: Title + drag/drop files; uses Vercel Blob (@vercel/blob) with fallback to data URLs.
   - Purpose: ‚ÄúFor Verification‚Äù (submitted) or ‚ÄúJust Share‚Äù (approved straight to repo).
   - List-first page: gallery grid; viewer modal with all attachments; manager Approve/Reject inline.
   - Navbar + dashboards: added entry points (General, Shared, Navbar).
   - API: POST accepts status submitted/approved; robust insert if task_id migration not applied yet.

9) Meed Community (School-wide social feed)
   - New schema + API for community posts and attachments.
   - Reactions: üëç ‚ù§Ô∏è üî• üëè üéâ (toggle per user/type) with counts and ‚Äúyours‚Äù.
   - Comments: inline thread per post with avatars; add comment box.
   - Gallery layout (reels-like) with Create Post modal (Blob-powered uploads).
   - Navbar: compact Instagram-style icon to open Community; mobile menu entries added.

6) Member‚Äëread API access
   - Opened read guards for members on: slots, metaPrograms, programPeriods, programScheduleCells, mspCodes, mspCodeAssignments.
   - Admin/team_manager still required for mutations/seeding.

Open issues / fixes
- Placeholder parsing in Routine Manager: fixed with safe template literal.
- ‚Äúasg not defined‚Äù in MSP‚ÄëR: replaced with activeAsg.userId. (resolved)
- General Dashboard hydration mismatch: removed SSR randomness (animated background now mounts client‚Äëside only). (resolved)
- MSP‚ÄëR modal hooks error: removed early returns before hooks and fixed variable init order. (resolved)
- MeedRepo insert task_id missing: fallback insert for envs without migration. (resolved)
- Upload API: unified on @vercel/blob put(); graceful fallback to data URLs in dev. (resolved)

Planned next (Resource Management ‚Äî Managerial > Resource Management)
Phase 1: Schema
- resources(id, name, assetTag, categoryId, status, location, assignedTo, serialNo, vendor, purchaseDate, warrantyEnd, cost, notes, tags[], createdAt)
- resourceCategories(id, name, parentId, description)
- resourceLogs(id, resourceId, kind(check_out/in, maintenance, issue, transfer, retire), byUserId, toUserId, notes, scheduledAt, completedAt, createdAt)
- resourceAttachments(id, resourceId, title, url, mimeType, uploadedBy, createdAt)

Phase 2: API (admin/team_manager)
- GET /api/admin/resources (filters: query, status, category, location, page)
- POST /api/admin/resources (create)
- PATCH /api/admin/resources (batch updates)
- GET /api/admin/resources/:id (detail)
- POST /api/admin/resources/:id/logs (actions/logs)
- GET/POST /api/admin/resources/categories

Phase 3: UI Shell
- Sidebar: add ‚ÄúResource Management‚Äù under Managerial.
- /dashboard/admin/manageMeedian/resources
  - List/table toggle, filters, bulk actions, quick metrics.
  - Drawer/detail: Overview, Activity, Maintenance, Attachments.

Phase 4+: Actions & niceties
- Check‚Äëout/in, Assign, Move, Maintenance logs.
- Import/Export CSV, QR labels, attachments upload.
- Optional reminders for warranty/maintenance.

Notes
- AI assist endpoint now allows model override from a safe allowlist.
- DM footer is optional; templates prefill subject/body.
 - Dashboard MSP‚ÄëR supports both tracks; consider CSV export and owner tooltips inline.
 - MeedRepo/Community: consider reactions/comments for Repo and moderation tools for Community.

Checklist
[ ] Add schema for resources + drizzle migration
[ ] Wire API handlers
[ ] Sidebar ‚ÄúResource Management‚Äù item
[ ] Resources list shell with filters + metrics
[ ] Detail drawer with logs/actions

Add‚Äëons (next)
[ ] Manager verification dashboard (all submitted, approve/reject inline)
[ ] Community moderation (delete/hide post/comment)
[ ] Infinite scroll/pagination for feeds
[ ] Lightbox carousel for multi-attachment posts

QA checklist (MSP‚ÄëR Dashboard)
[x] Class‚Äëwise table shows codes/subjects
[x] Teacher‚Äëwise highlights owned cells only
[x] Track toggle works and shows hint when no ownership
[x] Mobile stacked layout for both modes
[x] Code Owners modal reflects current track and schedule
